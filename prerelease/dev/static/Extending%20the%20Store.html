<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.10-prerelease" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>Extending the Store: TiddlyWiki/Dev â€” documentation for developers</title>
</head>
<body class="tc-body">
<p><div class="tc-static-alert"><div class="tc-static-alert-inner">This page is part of a static HTML representation of the TiddlyWiki at <a class="tc-tiddlylink-external" href="http://tiddlywiki.com/dev/" target="_blank">http://tiddlywiki.com/dev/</a></div></div>
</p>
<section class="tc-story-river">

<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   tc-tagged-doc"><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
Extending the Store
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal">
<button aria-label="fold tiddler" class="tc-fold-banner" title="Fold the body of this tiddler">

<svg class="tc-image-chevron-up tc-image-button" height="22pt" viewBox="0 0 128 128" width="22pt">
	<g fill-rule="evenodd" transform="translate(64.000000, 89.500000) rotate(-90.000000) translate(-64.000000, -89.500000) translate(-22.500000, 22.500000)">
        <path d="M112.743107,112.12741 C111.310627,113.561013 109.331747,114.449239 107.145951,114.449239 L27.9777917,114.449239 C23.6126002,114.449239 20.0618714,110.904826 20.0618714,106.532572 C20.0618714,102.169214 23.6059497,98.6159054 27.9777917,98.6159054 L99.2285381,98.6159054 L99.2285381,27.365159 C99.2285381,22.9999675 102.77295,19.4492387 107.145205,19.4492387 C111.508562,19.4492387 115.061871,22.993317 115.061871,27.365159 L115.061871,106.533318 C115.061871,108.71579 114.175869,110.694669 112.743378,112.127981 Z" transform="translate(67.561871, 66.949239) rotate(-45.000000) translate(-67.561871, -66.949239) "></path>
        <path d="M151.35638,112.12741 C149.923899,113.561013 147.94502,114.449239 145.759224,114.449239 L66.5910645,114.449239 C62.225873,114.449239 58.6751442,110.904826 58.6751442,106.532572 C58.6751442,102.169214 62.2192225,98.6159054 66.5910645,98.6159054 L137.841811,98.6159054 L137.841811,27.365159 C137.841811,22.9999675 141.386223,19.4492387 145.758478,19.4492387 C150.121835,19.4492387 153.675144,22.993317 153.675144,27.365159 L153.675144,106.533318 C153.675144,108.71579 152.789142,110.694669 151.356651,112.127981 Z" transform="translate(106.175144, 66.949239) rotate(-45.000000) translate(-106.175144, -66.949239) "></path>
	</g>
</svg>
</button>
</div>

<div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href=".html">

</a> 14 months ago
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"><span class="tc-tag-list-item">


<button class="tc-btn-invisible tc-tag-label" style="background-color:;
fill:#4e432f;
color:#4e432f;">
 doc
</button>
<span class=" tc-reveal" hidden="true"></span>


</span>
</div>
</div>
<div class="tc-tiddler-body tc-reveal"><h2 class="">Event Mechanism</h2><p>Most of the following mechanisms need a way to get notified, when anything in the wiki store changes.
The core -plug-in adds an event system to the bare wiki store.
The event system provides the ability to listen to events. The most important is the &quot;change&quot; event which notifies the listeners when tiddlers have changed, with a list of the changed tiddlers.
The event mechanism is one of the few mechanisms which needs a hook at the microkernel:
The microkernel contains an empty function &quot;enqueueTiddlerEvent(event)&quot; and calls this function when a tiddler is added or deleted.
The event mechanism from the core plug-in overwrites this function with it's own implementation.
The functions providing the event system are added via the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="wikimethod%2520module%2520type.html">wikimethod module type</a>.</p><h2 class="">Caching</h2><p>The core plug-in adds two caches to the wiki store.
A global cache and a cache for each tiddler.
While the global cache is cleared whenever any tiddler changes, the tiddler cache is only cleared when the associated tiddler changes.
The idea of the tiddler cache is, that sometimes we want to calculate information from a tiddler but don't want to recalculate every time we need this information.
Imagine a tiddler which contains links to other tiddlers and at one point we want to have a list of the linked tiddlers (<a class="tc-tiddlylink tc-tiddlylink-missing" href="LinksFilter.html">LinksFilter</a>).
With the tiddler cache we can parse the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="WikiText.html">WikiText</a>, extract the linked tiddlers and put this list in the cache.
Until the tiddler is changed, the cache can be used to access this information in the next requests.</p><p>The same idea holds for the global cache. For example when a <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Tags%2520and%2520Filter%2520Mechanism.html">filter</a> string is parsed and a list of matching tiddlers is constructed.
This list can be put in the global cache for later reuse until something changes in the store.</p><p>Like the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Event%2520Mechanism.html">Event Mechanism</a>, the cache needs hook functions in the microkernel.
The microkernel calls <code>clearGlobalCache()</code> and <code>clearCache(tiddlertitle)</code> when a tiddler changes.
The core's cache mechanism overwrites this functions.
The functions providing the cache system are added via the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="wikimethod%2520module%2520type.html">wikimethod module type</a>.</p><h2 class="">System Tiddlers</h2><p>The core plug-in introduces a segregation of tiddlers.
The tiddler model is central in the whole <a class="tc-tiddlylink tc-tiddlylink-resolves" href="TiddlyWiki.html">TiddlyWiki</a> application and can be used in various roles.
Because of the fact that a <a class="tc-tiddlylink tc-tiddlylink-resolves" href="TiddlyWiki.html">TiddlyWiki</a> user works with tiddlers (taking the role of a wiki page) and tiddlers are the building blocks of the whole application (including modules, UI elements, etc.) we need to identify the internal tiddlers.</p><p>The core plug-in introduces the concept of system tiddlers. It builds on the convention that application internal tiddler names start with <code>$:/</code>.
Then the core plug-in introduces a set of new functions to the wiki store which are used to retrieve tiddlers like <code>getTiddlers(options)</code> and <code>forEachTiddler(callback, options)</code>.
These functions work with all tiddlers in the store but the options parameter provides the ability to sort tiddlers by a field-name and exclude tiddlers with a specific tag.
By default it doesn't return system tiddlers. To get a list of all tiddlers including system tiddlers, this must be requested explicitly via the options.
If a function wants to present a list of tiddlers to the user it can use this new functions so that internal application tiddlers wouldn't clutter the resulting list.
These functions are added via the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="wikimethod%2520module%2520type.html">wikimethod module type</a>.</p><h2 class="">Tags and Filter Mechanism</h2><h3 class="">Tags</h3><p>The core plug-in extends the store by a simple mechanism to tag a tiddler.
This provides the functionality to</p><ul><li>retrieve tiddlers with a specific tag</li><li>retreive a hashmap of <code>{ tag: [tiddler1, tiddler3, tiddler3] }</code></li><li>list or iterate tiddlers not tagged with a specific tag</li></ul><p>The tags are stored directly in the tiddler. Each tiddler can have a field named &quot;tag&quot;, which contains an array of its tags.
The above functions use this field to calculate their results and cache them in a global cache.</p><p>Organising information with tags is easy, intuitive and is common throughout the web.
In most cases the functions mentioned above are not enough and a more sophisticated way of querying is needed.
But instead of focusing only on tags <a class="tc-tiddlylink tc-tiddlylink-resolves" href="TiddlyWiki.html">TiddlyWiki</a> introduces a querying system that isn't bound to tags or single tiddlers.</p><h3 class="">Filter mechanism</h3><p>This filter mechanism is build on the idea of a pipeline of single filter operators.
Filters are noted as strings and can look like</p><pre><code>[tag[task]!tag[done]interesting[very]]</code></pre><p>This example would (implicitly) put all available tiddlers into the pipe.
The first operator <code>tag[task]</code> would only pass tiddlers which are tagged with &quot;task&quot;.
The <code>!tag[done]</code> operator is negated and only passes tiddlers which are not tagged with &quot;done&quot;.
The last filter operator passes only tiddlers with a field &quot;interesting&quot; set to &quot;very&quot;.
So as a result this filter would be used to obtain all tiddlers which are marked as task, aren't already done and are very interesting.</p><p>There are many filter operators already build into the core plug-in including the mentioned tag- and field operators, filter operators to sort the tiddlerlist by a specified field, etc.
But more sophisticated operators are possible, too.
An example would be the search-operator. This filter operator looks for the searched string in the text and in the tags of the tiddlers.
If the provided filter operators are not enough, a developer can add new filters by adding a module with the <code>filteroperator</code> type.</p><h3 class="">System Tags</h3><p>Tags and the filter mechanism are used throughout the core plug-in for internal puproses.
Tags which start with <code>$:/</code> are normally hidden from the casual user, similar to <a class="tc-tiddlylink tc-tiddlylink-resolves" href="System%2520Tiddlers.html">System Tiddlers</a></p><p>The filter mechanism is added to the wiki store with the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="wikimethod%2520module%2520type.html">wikimethod module type</a>.
</p></div>



</div>

</p>

</section>
</body>
</html>
