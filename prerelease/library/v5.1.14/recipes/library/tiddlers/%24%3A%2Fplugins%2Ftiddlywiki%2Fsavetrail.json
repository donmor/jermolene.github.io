{
    "title": "$:/plugins/tiddlywiki/savetrail",
    "description": "Auto-download modified tiddlers",
    "author": "JeremyRuston",
    "core-version": ">=5.0.0",
    "list": "readme settings",
    "version": "5.1.14-prerelease",
    "plugin-type": "plugin",
    "dependents": "",
    "type": "application/json",
    "text": "{\n    \"tiddlers\": {\n        \"$:/config/SaveTrailPlugin/enable-drafts\": {\n            \"title\": \"$:/config/SaveTrailPlugin/enable-drafts\",\n            \"text\": \"no\"\n        },\n        \"$:/config/SaveTrailPlugin/enable\": {\n            \"title\": \"$:/config/SaveTrailPlugin/enable\",\n            \"text\": \"yes\"\n        },\n        \"$:/config/SaveTrailPlugin/save-filter\": {\n            \"title\": \"$:/config/SaveTrailPlugin/save-filter\",\n            \"text\": \"[is[tiddler]] -[[$:/HistoryList]] -[[$:/StoryList]] -[prefix[$:/config/]] -[prefix[$:/temp/]] -[prefix[$:/state/]] -[prefix[$:/status/]]\"\n        },\n        \"$:/plugins/tiddlywiki/savetrail/readme\": {\n            \"title\": \"$:/plugins/tiddlywiki/savetrail/readme\",\n            \"text\": \"This plugin causes TiddlyWiki to continuously save the contents of each tiddler that is changed as a JSON file. Configured correctly, the browser will download the files silently in the background, and they can be used as a backup in case of accidental data loss.\\n\\n''CAUTION'': Using this plugin will generate a //lot// of files in your downloads folder! Some points to watch:\\n\\n* This plugin is pretty much unusable unless your browser is set up to download files automatically, without prompting for the location\\n* Automatic file downloading doesn't work in all browsers - in particular, Safari and Internet Explorer do not currently support the [[necessary HTML5 feature|http://caniuse.com/download]]\\n* Be aware of the privacy implications of leaving a plaintext trail of all of your edits. You should only enable this plugin on computers that your trust and with content that is not sensitive\\n* The plugin uses the tiddler title plus a timestamp to generate a filename for the downloaded file, but some browsers don't respect\\n\\nOther points to note:\\n\\n* By default, after a tiddler has been modified the plugin waits until at least one second has elapsed since the last modification before it attempts to save the tiddler. This reduces the number of times that rapidly changing tiddlers are saved\\n* This plugin can be used with both the single file HTML configuration and under Node.js because it is independent of the usual saving and syncing processes\\n\"\n        },\n        \"$:/plugins/tiddlywiki/savetrail/savetrail.js\": {\n            \"text\": \"/*\\\\\\ntitle: $:/plugins/tiddlywiki/savetrail/savetrail.js\\ntype: application/javascript\\nmodule-type: startup\\n\\nA startup module to download every changed tiddler as a JSON file\\n\\n\\\\*/\\n(function(){\\n\\n/*jslint node: true, browser: true */\\n/*global $tw: false */\\n\\\"use strict\\\";\\n\\n// Export name and synchronous status\\nexports.name = \\\"savetrail\\\";\\nexports.platforms = [\\\"browser\\\"];\\nexports.after = [\\\"startup\\\"];\\nexports.synchronous = true;\\n\\n// Favicon tiddler\\nvar SAVE_FILTER_TIDDLER_TITLE = \\\"$:/config/SaveTrailPlugin/save-filter\\\",\\n\\tENABLE_TIDDLER_TITLE = \\\"$:/config/SaveTrailPlugin/enable\\\",\\n\\tENABLE_DRAFTS_TIDDLER_TITLE = \\\"$:/config/SaveTrailPlugin/enable-drafts\\\";\\n\\nexports.startup = function() {\\n\\t$tw.savetrail = $tw.savetrail || {};\\n\\t$tw.savetrail.syncadaptor = new SaveTrailSyncAdaptor();\\n\\t$tw.savetrail.syncer = new $tw.Syncer({\\n\\t\\twiki: $tw.wiki,\\n\\t\\tsyncadaptor: $tw.savetrail.syncadaptor,\\n\\t\\ttitleSyncFilter: SAVE_FILTER_TIDDLER_TITLE,\\n\\t\\tlogging: false\\n\\t});\\n};\\n\\nfunction SaveTrailSyncAdaptor(options) {\\n\\tthis.logger = new $tw.utils.Logger(\\\"SaveTrail\\\");\\n}\\n\\nSaveTrailSyncAdaptor.prototype.name = \\\"savetrail\\\";\\n\\nSaveTrailSyncAdaptor.prototype.isReady = function() {\\n\\t// The savetrail adaptor is always ready\\n\\treturn true;\\n};\\n\\nSaveTrailSyncAdaptor.prototype.getTiddlerInfo = function(tiddler) {\\n\\treturn {};\\n};\\n\\n/*\\nSave a tiddler and invoke the callback with (err,adaptorInfo,revision)\\n*/\\nSaveTrailSyncAdaptor.prototype.saveTiddler = function(tiddler,callback) {\\n\\tif($tw.wiki.getTiddlerText(ENABLE_TIDDLER_TITLE).toLowerCase() === \\\"yes\\\") {\\n\\t\\tvar isDraft = $tw.utils.hop(tiddler.fields,\\\"draft.of\\\");\\n\\t\\tif(!isDraft || $tw.wiki.getTiddlerText(ENABLE_DRAFTS_TIDDLER_TITLE).toLowerCase() === \\\"yes\\\") {\\n\\t\\t\\tsaveTiddlerFile(tiddler);\\n\\t\\t}\\n\\t}\\n\\tcallback(null);\\n};\\n\\n/*\\nLoad a tiddler and invoke the callback with (err,tiddlerFields)\\n\\nWe don't need to implement loading for the file system adaptor, because all the tiddler files will have been loaded during the boot process.\\n*/\\nSaveTrailSyncAdaptor.prototype.loadTiddler = function(title,callback) {\\n\\tcallback(null,null);\\n};\\n\\n/*\\nDelete a tiddler and invoke the callback with (err)\\n*/\\nSaveTrailSyncAdaptor.prototype.deleteTiddler = function(title,callback,options) {\\n\\tcallback(null);\\n};\\n\\nfunction saveTiddlerFile(tiddler) {\\n\\tvar illegalFilenameCharacters = /<|>|\\\\:|\\\\\\\"|\\\\/|\\\\\\\\|\\\\||\\\\?|\\\\*|\\\\^|\\\\s/g,\\n\\t\\tfixedTitle = tiddler.fields.title.replace(illegalFilenameCharacters,\\\"_\\\"),\\n\\t\\tformattedDate = $tw.utils.stringifyDate(new Date()),\\n\\t\\tfilename =  fixedTitle + \\\".\\\" + formattedDate + \\\".json\\\",\\n\\t\\tfields = new Object();\\n\\tfor(var field in tiddler.fields) {\\n\\t\\tfields[field] = tiddler.getFieldString(field);\\n\\t}\\n\\tvar text = JSON.stringify(fields,null,$tw.config.preferences.jsonSpaces),\\n\\t\\tlink = document.createElement(\\\"a\\\");\\n\\tlink.setAttribute(\\\"target\\\",\\\"_blank\\\");\\n\\tlink.setAttribute(\\\"rel\\\",\\\"noopener noreferrer\\\");\\n\\tif(Blob !== undefined) {\\n\\t\\tvar blob = new Blob([text], {type: \\\"text/plain\\\"});\\n\\t\\tlink.setAttribute(\\\"href\\\", URL.createObjectURL(blob));\\n\\t} else {\\n\\t\\tlink.setAttribute(\\\"href\\\",\\\"data:text/plain,\\\" + encodeURIComponent(text));\\n\\t}\\n\\tlink.setAttribute(\\\"download\\\",filename);\\n\\tdocument.body.appendChild(link);\\n\\tlink.click();\\n\\tdocument.body.removeChild(link);\\n}\\n\\n})();\\n\",\n            \"title\": \"$:/plugins/tiddlywiki/savetrail/savetrail.js\",\n            \"type\": \"application/javascript\",\n            \"module-type\": \"startup\"\n        },\n        \"$:/plugins/tiddlywiki/savetrail/settings\": {\n            \"title\": \"$:/plugins/tiddlywiki/savetrail/settings\",\n            \"text\": \"\\n<$checkbox tiddler=\\\"$:/config/SaveTrailPlugin/enable\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\"> Enable automatic saving of modified tiddlers</$checkbox>\\n\\n<$checkbox tiddler=\\\"$:/config/SaveTrailPlugin/enable-drafts\\\" field=\\\"text\\\" checked=\\\"yes\\\" unchecked=\\\"no\\\"> Include automatic saving of draft tiddlers (warning: generates a lot of download files)</$checkbox>\\n\\n[[Filter|$:/config/SaveTrailPlugin/save-filter]] used to determine tiddlers that should be autosaved:\\n\\n<$edit-text tiddler=\\\"$:/config/SaveTrailPlugin/save-filter\\\" tag=\\\"textarea\\\" class=\\\"tc-edit-texteditor\\\"/> \\n\\n\"\n        }\n    }\n}"
}